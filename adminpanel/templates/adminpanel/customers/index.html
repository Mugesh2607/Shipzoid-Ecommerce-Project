{% extends 'adminpanel/layouts/base.html' %}
{% block content %}

    <div id="content-area" class="flex-1 p-4 lg:p-8 gradient-bg font-inter">

        <!-- Header & Create Button -->
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold text-slate-800 flex items-center gap-2">
           <i class="fa-solid fa-solid fa-user-gear text-shipzoid-teal"></i>Customers
            </h2>
        </div>

        <!-- DataTable Container -->
        <div class="overflow-x-auto bg-white border border-slate-200 rounded-xl shadow-lg transition hover:shadow-xl p-4">
            <table id="customerTable" class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">S.No</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Customer Name</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Phone Number</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Email</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">City</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">State</th>
                         <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Action</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>


<!-- DataTable & Modal Script -->
<script>
        $(document).ready(function () {
            const customerViewUrl = "{% url 'adminpanel:customer_view' 'ENCRYPTED_ID' %}";
            const table = $('#customerTable').DataTable({
                ajax: {
                    url: "{% url 'adminpanel:get_customers' %}", // Django URL pattern name
                    type: 'GET',
                    dataSrc: 'data' // The key in the JSON that contains the array
                },
                columns: [
                    {
                        data: null,
                        className: 'px-6 py-4 whitespace-nowrap text-sm text-gray-700',
                        orderable: false,
                        searchable: false,
                        render: function (data, type, row, meta) {
                            return meta.row + 1 + meta.settings._iDisplayStart; // serial number (1-based)
                        }
                    },
                    { data: 'full_name', className: 'px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center' },
                    { 
                        data: 'phone_number', className: 'px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center'
                    },
                      { 
                        data: 'email', className: 'px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center'
                    },
                     { 
                        data: 'city', className: 'px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center'
                    },
                      { 
                        data: 'state', className: 'px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center'
                    },
                     {
                        data: null,
                        className: 'px-6 py-4 whitespace-nowrap text-sm text-center',
                        render: function (data, type, row) {
                           let url = customerViewUrl.replace('ENCRYPTED_ID', row.encrypted_id);
                           let buttons = ``;

                            buttons += `
                                <button onclick="window.location.href='${url}'"
                                    class="text-shipzoid-teal hover:text-shipzoid-teal mr-3">
                                    <i class="fas fa-eye"></i>
                                </button>
                            `;

                            return buttons;

                        }
                    }
                    
                ],
                responsive: true,
                paging: true,
                searching: true,
                ordering: false,
                lengthMenu: [[10, 25, 50, 100, -1], [10, 25, 50, 100, "All"]],
                language: {
                    loadingRecords: `
                        <div class="flex flex-col items-center justify-center py-6">
                            <div class="w-8 h-8 border-4 border-shipzoid-teal border-t-transparent rounded-full animate-spin"></div>
                            <span class="mt-2 text-gray-600 text-sm">Loading data...</span>
                        </div>
                    `,
                        emptyTable: `
                        <div class="flex flex-col items-center justify-center py-6 text-center text-gray-900 dark:text-gray-100">
                            <p class="text-lg font-semibold">No brands found</p>
                        </div>
                    `

      
                },
                initComplete: function () {
                    $('#customerTable_filter input')
                        .addClass('border border-shipzoid-teal rounded-lg px-3 py-1 focus:outline-none focus:ring-2 focus:ring-shipzoid-teal/40')
                        .attr('placeholder', 'Search...');
                    $('#customerTable_length select')
                        .addClass('border border-shipzoid-teal rounded-lg px-2 py-1 focus:outline-none focus:ring-2 focus:ring-shipzoid-teal/40');
                    $('#customerTable_paginate').addClass('mt-3');
                    $('#customerTable_paginate .paginate_button')
                        .addClass('border border-gray-300 rounded-md px-3 py-1 mx-1 text-sm text-gray-700 hover:bg-blue-100');
                }
            });
        });


</script>

{% endblock %}
